

# RookMotion Watch Link

RookMotion watch link  allows new and existing applications to integrate RookMotion functionalities for training measurement, tracking, and analysis.

RookMotion watch link  is designed with the intention to be:

* Fast Integration: Useful to integrate fast and easy using pre-created views with RookMotion design and pre-automated flows. For reference: 4h to re-create the demo app.
* Full personalization: Better for apps with a dedicated development team, developers can call each SDK function in theirs desired order and create and fill their with a personalized UI.

These functionalities are:

* User's info, workouts, rewards, and statistics management in complement with the RookMotion API.

## Keywords

| keyword      | Def |
| ----------- | ----------- |
| **Client**  | Billing account. Person or company which contracts the usage of the API. A client can have multiple centers, branches, rooms or be virtual |
| **client_key**  | Unique identifier provided by the RookMotion API account manager for each center/branch/room of the client. This is used to redirect client API request to his correspondent tenancy. |
| **Chain**  | An entity or brand operating under the same client's entity |
| **chain_uuid**  | Unique identifier for a chain entity. Cannot be created with the SDK. Chains are created directly with the API.|
| **Branch**  | A sucursal or branch of a chain entity |
| **branch_uuid**  | Unique identifier for a branch entity. Cannot be created with the SDK. Chains are created directly with the API.|
| **Room**  | A branch section or division where training is performed. This is the smallest part of the business structure. Rooms can be physical, remote or virtual.  |
| **room_uuid**  | Unique identifier for a branch entity. Cannot be created with the SDK. Chains are created directly with the API.|
| **token_level**  | Unique identifier for each entity of the business structure. Each API request requires a token_level which allows the API to identify the entity where the request/query should be performed. token_level's are created by the API when a chain or branch or room is created. |
| **User**  | A person which uses the RookMotion API through the client APP to perform trainings. |
| **user_uuid**  | Unique identifier for each user, it's generated by the RookMotion API for each user added with API.addUser.|
| **Sensor**  | A Bluetooth peripheral device with a training variable measurement such as heart rate.    |
| **sensor_uuid**  | Unique identifier for each training sensor, it's generated by the RookMotion API for each sensor added to the user with API.addSensor.|
| **Training**  | Routine or workout perfomed using a heart rate sensor where the measurement records are obtained, stored and proccessed using the RookMotion SDK/API.|
| **training_uuid**  | Unique identifier for each training, it's generated by the RookMotion API for each training added to the user with API.addTraining.|

## Contents

1. [Installation](#user-content-installation)
2. [Configuration](#user-content-configuration)
3. [Package usage](#user-content-package-usage)
    * [RWCommunicationManager class](#user-content-rwcommunicationmanager-class)
     * [AuthorizationManager](#user-content-authorizationmanager)
    * [WorkoutManager](#user-content-workoutmanager)
    * [Repository classes](#user-content-repository-classes)
        * [Repository Training Types](#user-content-repository-training-types)
        * [Repository Training](#user-content-repository-training)
        * [Repository User](#user-content-repository-user)
    * [NetworkManager](#user-content-networkmanager)
        * [RWUserAPI](#user-content-rwuserapi)
        * [RWTrainingAPI](#user-content-rwtrainingapi)
        * [RWTrainingTypeAPI](#user-content-rwtrainingtypeapi)
        * [RWSensorAPI](#user-content-rwsensorapi)
        * [RWRealTimeAPI](#user-content-rwrealtimeapi)
    * [RWStorageManager class](#user-content-rwstoragemanager-class)
    * [BackGroundTasks](#user-content-backgroundtask)
    * [RWModels](#user-content-rmmodels)


## Installation ##

### required software

To build a project using the RookMotion SDK you need to download and install
* [Xcode](https://developer.apple.com/xcode/) version 14.0 or later.
* [Cocoapods](https://guides.cocoapods.org/using/getting-started.html)

The watch OS deployment minimum target is 6.2 and the swift version is 5.0.

RookMotionLink is available through CocoaPods. To install it, simply follow the next steps:

1. Creat a Podfile.

```console
pod init
```

2. Open your Podfile

```console
open .Podfile -a xcode
```

3. Add the following line to your Podfile in your watchKit extension

```Ruby
    pod 'RookMotionWatchLink', :git => "https://gitlab.com/rooklinkforclients/rookmotionwatchlink.git"
```

4. Add the following lines at the end of the Podfile

```Ruby
post_install do |installer|
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings['BUILD_LIBRARY_FOR_DISTRIBUTION'] = 'YES'
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '13.0'
      config.build_settings['WATCHOS_DEPLOYMENT_TARGET'] = '7.0'
    end
  end
end
```

4. run pod install

```console
pod install
```

## Configuration ##

Add your client_key and your token_level to your ```ExtensionDelegate.swift``` as follows:

* Import RookMotionWatchLink statement:

```swift
import RookMotionWatchLink
```

* Add the following lines to your `applicationDidFinishLaunching()` method, replacing *YOUR_KEY* and *YOUR_TOKEN* with your credential:

* The developer can set the `urlBase` to sandbox environment or production environment.

* The developer can set the `urlRemote` to sandbox environment or production environment for remote trainings.


```swift
func  applicationDidFinishLaunching() {
        let clientKey = "YOUR_KEY"
        let tokenLevel = "YOUR_TOKEN"
                let urlBase = "YOUR_BASE_URL"
                let urlRemote = "YOUR_REMOTE_URL"

        RWRookSettings.shared.setCredentials(client_key: clientKey, token: tokenLevel)
        RWRookSettings.shared.setUrlApi(with: urlBase)
        RWRookSettings.shared.setUrlRemote(with: urlRemote)
        RWRookSettings.shared.initRookMotionSDK()
    }
```
Before to use all the classes and method the following permissions have to be in the Info.plist file.

![info_plist](/infoplist_configuration.png)

| Key | Type | String |
| ---- | ------ | ---- |
| Privacy - Health Share Usage Description | `String` | We will use your health information to better track of your workouts..|
| Privacy - Health Update Usage Description | `String` | We will use your health information to better track of your workouts.. |

**Note: It is important that: `Workout processing` option is enabled in Background Mode. and HealthKit has to be added**

![configuration_capabilities](/configuration_capabilities.png)

## Package usage

###  RWCommunicationManager class

```swift
public class RWCommunicationManager
```

The `RWCommunicationManager` class allows the watch app communicate with the iOS companion app.

Your iOS app and watchOS app must both create and configure an instance of this class at some point during their execution

The CommunicationManager must be configured and activated before you attempt to send messages or obtain information about the state of the connection.

| Returns      | Function |
| ----------- | ----------- |
|```void```      | ```configureSession()``` |
|```void``` | ```sendInfo(_ info: [String: Any])``` |


#### configureSession()
```swift
public func configureSession()
```
Configure the communication session with the iOS app

#### sendInfo()
```swift
public func sendInfo(_ info: [String: Any])
```
Sends the specified data dictionary to the counterpart.

Call this method when you want to send a dictionary of data to the counterpart and ensure that it’s delivered. Dictionaries sent using this method are queued on the other device and delivered in the order in which they were sent. After a transfer begins, the transfer operation continues even if the app is suspended.

##### Example
```swift
let communicationManager  = RWCommunicationManager.shared
sensorManager.configureSession()
let info = ["sync": "info"]
sensorManager.sendInfo(info)
```


### SendPendingTraining

Calling this method sends a the training object to the device paired.

```swift
  public func sendPendingTraining(_ unfinishTraining: RWTrainingInfo)
```

**parameters**
- unfinishTraining: `RWTrainingInfo` objet to send.

#### Example
```swift
let communicationManager  = RWCommunicationManager.shared
let storageManager: RMStorageManager = RMStorageManager()

func sendTraining() {
  guard let training = storageManager.getUnfinishedTrainings().first { 
    return
  }
  communicationManager.sendPendingTraining(training)
}
```

### Delegate

You must assign an object conforming to the RWCommunicationDelegate protocol to this. The delegate is responsible for responding to session-related changes, for processing incoming data, and for responding to errors.

#### RWCommunicationDelegate

A set of methods that provide the data related to the connection information

```swift
public protocol RWCommunicationDelegate
```

|Function| Description|
|-------|------------|
|```session(_ session: WCSession, messageData: [String : Any])```|Tells the delegate when a message has been received. |
|```session(_ session: WCSession, userInfo: [String : Any])``` |Tells the delegate when a dictionary has been received.|
|```session(_ session: WCSession, message: [String : Any])```| Tells the delegate when a message has been received. |
|```userInfoSaved(_ session: WCSession, watchMessage: [String: Any])```| Tells the delegate when a new user information has been received and stored. |



### AuthorizationManager

```swift
public class  AuthorizationManager: NSObject
```
This class was created to requests permission to save and read the specified data that will be used to store the workouts.

**Warning. You must request the permission before start a workout and the user should allow them to enable the reading data**

#### Methods

| Returns      | Function |
| ----------- | ----------- |
| void | ```requestAuthorization(completionHandler: @escaping((_ success: Bool) -> Void))``` |

#### requestAuthorization()
```swift
public func requestAuthorization(completionHandler: @escaping((_ success: Bool) -> Void))
```
AuthorizationManager performs these requests asynchronously. If you call this method  a type of data that the user hasn’t previously granted or denied permission for in this app, the system automatically displays the permission form, listing all the requested permissions. After the user has finished responding, this method calls its completion block on a background queue. If the user has already chosen to grant or prohibit access to all of the types specified, HealthKit calls the completion without prompting the user.

### WorkoutManager

```swift
public class  WorkoutManager: NSObject
```
The workout class provides automated methods to perform a workout, this class collects all the data of a training and uploads all the information to the server.

#### Properties

| Name | Type | Description |
| ---- | ---- | ----------- |
| delegate | `WorkoutManagerDelegate` | The delegate receives notifications when a workout session’s state changes or when a workout session fails. |
| state | `WorkoutState` |  This property indicates the current state of a workout |
| remoteClass | ```RWRookRemoteClass``` | This model contains all the information to connect a remote class |
| duration | ```Float``` | The number of seconds of the training duration |

#### Methods

| Returns      | Function |
| ----------- | ----------- |
| `void` | `start(configuration: RookTrainingConfiguration?)` |
| `void` | `pauseTraining()` |
| `void` | `resumenTraining()` |
| `void` | `stop()` |
| `void` | `restoreTraining(with pendingTraining: RWRookTrainingDTO)`|

#### start()
```swift
public func start(configuration: WorkoutConfiguration?)
```

This method configures the training with the `RookTrainingConfiguration` object given, starts the activity and collect all the data of the session.

#### pauseWorkout()

```swift
public func pauseWorkout()
```

This method allows the user to pause a workout session.

#### resumenWorkout

```swift
public func resumenWorkOut()
```

It resumes a workout sessions that has been paused.

#### stop()

```swift
public func stop()
```

This method finish a workout all the information will be send to the rookmotion web server the training will be associate to the user stored in the local data base.

#### stopTraining

The stopTraining method was included this method ends the current training and it will try to upload to the API.

``` swift
public func stopTraining(completion: @escaping (RWTrainingUploadResponse) -> Void)
```


#### restoreWorkout()

```swift 
public func restoreWorkout(with pendingTraining: RWTrainingInfo)
```

In case a user kills the app while a training is running, this method allows to recover all the data stored of the training.

#### Notifications

The following notification are used to handle al the data coming from the measurements. 

use the `NotificationCenter` to add or remove a notification. 

| Name | Returns | Description |
| ------- | --------- | ------- |
| `kWorkoutDuration` | `["duration": Float]` | The notification returns a dictionary with the number of seconds in a workout, it updates every second. |
| `kTrainingPlayNotification` | `nil` | The notification indicates when a remote class whit waiting time room has started. |
| `kWorkoutHearRateData` | `["timeStamp": String, "heartRate" : Int, "calories" : Float, "effort" : Float, "heartRateVariability" : Int]`| Returns a dictionary with all the data from a heart rate sample this dictionary can be decoded with `RMHrDerivedRecord` object. |
| `kWorkoutStepData` | `["timestamp": String, "cadence": Float, "steps" : Int]` |  Returns a dictionary with all the data from a step sample this dictionary can be decoded with `RMStepDerivedRecord` object. |
| `kWorkoutFinish` | `nil` | The notification indicates when a remote workout has finished. |
| `kRemoteBadConnection` | `nil` | The notification indicates when the the remote data could not be upload due to bad internet connection |
| `kRemoteDataSended` | `nil` | The notification indicates when the real time data has been upload.  |

### Repository classes

These classes encapsulate the access data sources of workout types, user indexes and trainings.

### RepositoryTrainingTypes

This class allows the access to the training types if the trainings types are stored in the local data base and there is not internet connection the user is able to get those training types.

#### Methods

| Returns  | Function |
| ----------- | ----------- |
| `[RWRookTrainingType]` | `getTrainingTypes(completion: @escaping([RWRookTrainingType], Error?)` |
| `[RWRookRemoteClass]` | `getRemoteClasses(completion: @escaping([RWRookRemoteClass], Error?)` |

#### getTrainingTypes()

```swift
public func getTrainingTypes(completion: @escaping([RWRookTrainingType], Error?) -> Void)
```

This method retrieves a list of WorkoutType objects if there is no internet connection, it will return the workout types stored in the local data base.

#### getRemoteClasses()

```swift 
public func getRemoteClasses(completion: @escaping([RWRookRemoteClass], Error?) -> Void)
```

This method retrieves in the completion a list of `RWRookRemoteClass`objects which contains the information of all remote classes available for the user stored in the local data base

### RepositoryTraining

This class allows to store, retrieve and upload sensors and trainings.

| Returns      | Function |
| ----------- | ----------- |
| `RMWResponse` | `addSensor(sensorName: String, completion: @escaping (RMWResponse) -> Void)` |
| `RMWResponse` | `uploadPendingSensors(completion: @escaping (RMResponse) -> Void)` |
| `(RMWResponse, [RWRookSensorDTO])` | `getUserSensors(completion: @escaping (RMWResponse,[RWRookSensorDTO]?) -> Void)` |
| `RMWResponse` | `uploadPendingTrainings(delete: Bool, completion: @escaping (RMWResponse) -> Void)` |

#### addSensor()

```swift
public func addSensor(sensorName: String,
                      completion: @escaping (RMWResponse) -> Void
```

The method adds a Sensor object to the local data base and uploads that object to the web server this sensor is linked to the user stored in the local data base.

#### uploadPendingSensors()

```swift
public func uploadPendingSensors(completion: @escaping (RMWResponse) -> Void)
```

Uploads to the server all the sensors stored in the local data base.

#### getUserSensors() 

```swift
public func getUserSensors(completion: @escaping (RMWResponse,[RMSensorAPI]?) -> Void)
```

Retrieves a list of `RMSensorAPI` objects from the web server if there is no internet connection retrieves the list stored in the local data base.

#### uploadPendingTrainings()

```swift
public func  uploadPendingTrainings(delete: Bool,completion: @escaping (RMWResponse) -> Void)
```

The method uploads all the training stored in the local data base, if the `delete` input is set with true, the trainings stored will be deleted after the upload.

### Repository User

 The `RepositoryUser` class handle the request and storage of the user information in the local data base and the rook API.
 
 some of the methods of this class need a user stored in the local data base
 
 The  methods available in this class are:
 
 1. checkUserRookMotion
 2. getUserInfo
 3. updateUser
 4. addUserPhysiologicalVariables

 ```swift
  public class RepositoryUser: NSObject
 ```


 #### checkUserRookMotion

 Add a user to the web API and it will be stored in the local data base, if the email of the user is already registed it will return the uuid of the user
   - parameter email: `String` The sensor's name yo wan to store.
   - parameter completion: A block that it is called after the request is loaded. The system calls this block with the following parameters.
   - Result: with the uuid of the user added of an error

```swift
 public func checkUserRookMotion(email: String,
                                completion: @escaping(Result<String, Error>) -> Void)
```

#### getUserInfo

Returns the user information.
 - parameter Result UserInfoResponse, Error: Object that contains information of the response.

```swift
public func getUserInfo(completion: @escaping (Result<UserInfoResponse, Error>) -> Void)
```

#### updateUser

Updates the user infomation
   - parameter user: `UpdateUser` Object with user information to update
   - parameter completion: A block that it is called after the request is loaded. The system calls this block with the following parameters.
   - parameter Result: resut of the request

```swift
public func updateUser(user: UpdateUser,
                  completion: @escaping(Result<Bool, Error>) -> Void)
```

#### addUserPhysiologicalVariables

Adds a set of physiological variables
   - parameter physiological: `AddUserPysiolocalRequest` Object with physiological variables
   - parameter completion: A block that it is called after the request is loaded. The system calls this block with the following parameters.
   - parameter Result: resut of the request

```swift
public func addUserPhysiologicalVariables(physiological: AddUserPysiolocalRequest,
                                            completion: @escaping (Result<Bool, Error>) -> Void)
```

###  NetworkManager

```swift
public  struct  NetworkManager<T: EndPointType>
```
This struct is a layer that gives access to store or retrieve data from the web server, It is divided in four sublayers.

1. [RWTrainingAPI](#user-content-training-api)
2. [RWTrainingTypeAPI](#user-content-training-type-api)
3. [RWSensorAPI](#user-content-sensor-api)
4. [RWRealTimeApi](#user-content-realtime-api)

###  Training api

This extension of the layer allows to upload trainings to the web server.

```swift
extension  RWTrainingAPI: EndPointType
```

| Function      | Description |
| ----------- | ----------- |
| `public func addPendingTrainingToUser(userUUID: String, userToken: String? = nil, training: RWRookTrainingDTO, completion: @escaping(Int, String?, _ error: String?) -> Void)` | Uploads a training to the web server this workout will be linked to user uuid provided. |

#### addPendingTrainingToUser() 
```swift
public func addPendingTrainingToUser(userUUID: String, userToken: String? = nil,
                                     training: RWRookTrainingDTO,
                                      completion: @escaping(Int, String?, _ error: String?) -> Void)
```

Uploads a training to the web server this workout will be linked to user uuid provided.

##### Example
```swift
let networkManager = NetworkManager<RWTrainingAPI>()
let training = RWRookTrainingDTO()
let userUuid = "fief-2dwd2-222dd"

networkManager.addPendingTrainingToUser(userUUID: userUuid, training: training) { (httpCode, response, error) in
    print(httpCode)
    
}
```

### TrainingTypeAPI

The extension of the layer provides the method to get a list of workout types.

```swift
extension  RWTrainingTypeAPI: EndPointType
```

| Function    | Description |
| ----------- | ----------- |
| ```getTrainingTypes(userToken: String? = nil, completion: @escaping([RWRookTrainingType]?, _ error: String?) -> Void)``` | Retrieves a list of `RWTrainingType`  objects. |

##### Example
```swift
let networkManager = NetworkManager<RWTrainingTypeAPI>()

networkManager.getTrainingTypes() { (trainingTypes, error) in
    print("Debug trainings \(trainingTypes)")
}
```

### RWSensorAPI

```swift
extension RWSensorAPI: EndPointType
```

| Function      | Description |
| ----------- | ----------- |
| ```addSesnorToUser(tokenUser: String? = nil, sensor_name: String,sensor_mac: String, ownership_type: String, userUUID: String, completion: @escaping(Int, String?, _ error: String?) -> Void)``` | The method adds a sensor to a user it will be stored in the web server
| `getUserSensor(userUUID: String, userToken: String? = nil, completion: @escaping([RMSensorAPI]?, _ error: String?) -> Void)` | The method retrieves a list of `RMSensorAPI`objects linked to a user. |


#### addSesnorToUser()

The method links a sensor to the user with the uuid given.

```swift
public func addSesnorToUser(tokenUser: String? = nil, sensor_name: String,
                             sensor_mac: String, ownership_type: String,
                             userUUID: String,
                             completion: @escaping(Int, String?, _ error: String?) -> Void)
```

##### Example

```swift
let networkManager = NetworkManager<RWSensorAPI>()
let sensorName = getWatchSensorName()
let userUuid = "fief-2dwd2-222dd"

networkManager.addSesnorToUser(sensor_name: sensorName,
                                sensor_mac: "",
                                 ownership_type: "owned", userUUID: userUuid) { (httpCode, response, error) in
    print(httpCode)
}
```

#### getUserSensor()

The method retrieves a list of `RMSensorAPI`objects linked to a user.

```swift
public func getUserSensors(userUUID: String, userToken: String? = nil, completion: @escaping**([RMSensorAPI]?, _ error: String?) -> Void)
```
##### Example

```swift
let networkManager = NetworkManager<RWSensorAPI>()
let userUuid = "fief-2dwd2-222dd"

networkManager.getUserSensor(userUUID: userUuid) { (userSensors, error) in
    print("sensors \(userSensors)")
}

```

### RWRealTimeApi

The extension includes all the request needed to start a remote class from apple watch

```swift
extension  RWRealTimeApi: EndPointType
```

| Function      | Description |
| ----------- | ----------- |
| `getRemoteRooms(userUUID: String, tokenUser: String? = nil, completion: @escaping ([RMRegisteredCenter]?, _ error: String?) -> Void)` | The method retrieves a list of `RMRegisteredCenter` objects which contains the information of the remote remotes. |
| `connectUserToClass(userUUID: String, classUUID: String, userToken: String? = nil, completion: @escaping(_ httpCode: Int, _ response : AddUserToRoomResponse? ,_ error: String?) -> Void)` | The method requests access to connect a user to a remote class. |
| `sendRealTimeData(to classUUID :String, realTimeData: RealTimeData, userToken: String? = nil, completion: @escaping(_ httpCode: Int, _ response: String?, _ error: String?) -> Void)` | The method sends a realtime data to a remote class. |
| `disconnectUserFromClass(with classUUID: String, userUUID: String, userToken: String)` | The method requests a disconnection from a remote class. |

#### getRemoteRooms()

The method retrieves a list of `RMRegisteredCenter` objects which contains the information of the remote remotes.

```swift
public func getRemoteRooms(userUUID: String, tokenUser: String? = nil, completion: @escaping ([RMRegisteredCenter]?, _ error: String?) -> Void)
```

##### Example

```swift
let networkManager = NetworkManager<RWRealTimeApi>()
let userUuid = "fief-2dwd2-222dd"

}
```

#### connectUserToClass()

The method requests access to connect a user to a remote class

```swift
public func connectUserToClass(userUUID: String, classUUID: String, userToken: String? = nil, completion: @escaping(_ httpCode: Int, _ response : AddUserToRoomResponse? ,_ error: String?) -> Void)
```

##### Example

```swift
let networkManager = NetworkManager<RWRealTimeApi>()
let userUuid = "fief-2dwd2-222dd"
let classUUID = "fief-2dwd2-222dd"

networkManager.connectUserToClass(userUUID: userUuid, classUUID: classUUID { (response, error) in
print("response \(resposne)")
}
```

#### sendRealTimeData()

The method sends a realtime data to a remote class.

```swift
public func sendRealTimeData(to classUUID :String, realTimeData: RealTimeData, userToken: String? = nil, completion: @escaping(_ httpCode: Int, _ response: String?, _ error: String?) -> Void)
```

##### Example

The method requests a disconnection from a remote class.

```swift
let networkManager = NetworkManager<RWRealTimeApi>()
let userUuid = "fief-2dwd2-222dd"
let classUUID = "fief-2dwd2-222dd"
let realTimeData = RealTimeData()

networkManager.sendRealTimeData(to: classUUID, realTimeData: realTimeData) { (httpCode, response, error) in
print("response \(response)")

}
```

#### disconnectUserFromClass()

```swift
public func disconnectUserFromClass(with classUUID: String, userUUID: String, userToken: String? = nil)
```

##### Example

```swift
let networkManager = NetworkManager<RWRealTimeApi>()
let userUuid = "fief-2dwd2-222dd"
let classUUID = "fisssf-2ssdwd2-222dd"

networkManager.disconnectUserFromClass(with: classUUID, userUUID: userUuid) 
```

### Storage

The main purpose of the modules that will be presented below of this section 
is store the information needed to make the app work offline.

**Note it is recommended to use the repository classes that are create to fetch the data online and offline**

## **RWStorageManager class**

RookUserStorage  stores the user information in the local data base this class is prepare to perform changes in the main thread and background thread

```swift
public class RookUserStorage
```

| Returns      | Function | Description |
| ----------- | ----------- | -------- |
| `void` | `public func storeUser(userToStore: UserDTO, context: ContextType)` | Stores a user in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext |
| `void` | `func deleteUser(context: ContextType)` | Delete the current user stored in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext |
| `UserDTO?` | `func readUser(context: ContextType) -> UserDTO?` | Returns the user stored in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext |

### StoreUser

Stores a user in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext

- parameter userToStore: `UserDTO` the object that contains the user information
 - parameter context: `ContextType` to select in which thread the operation will be performed.

```swift
public func storeUser(userToStore: UserDTO, context: ContextType)
```

### Delete user

Delete the current user stored in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext

- parameter context: `ContextType` to select in which thread the operation will be performed.

```swift
public func deleteUser(context: ContextType)
```

### Read user

Returns the user stored in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext.

- parameter userToStore: `UserDTO` the object that contains the user information
- parameter context: `ContextType` to select in which thread the operation will be performed.
   
- Returns: A `UserDTO?` optional object that contains the user's information.

```swift
public func readUser(context: ContextType) -> UserDTO?
```

## **RookSensorStorage class**

has an implementation to store, delete, update and read sensors, this class is prepare to perform changes in the main thread and background thread

```swift
public class RookSensorStorage
```

| Returns      | Function | Description |
| ----------- | ----------- | -------- |
| `void` | `func createSensor(sensorToStore: SensorDTO, context: ContextType)` | Stores a sensor in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext |
| `void` | `deleteSensor(sensor: SensorDTO, context: ContextType)` | Deletes a sensor in the local data base, If the action will be performed in the main thread the contect have to be the viewContext, in other case the context should be backGroundContext |
| `void` | `func updateSensor(sensor: SensorDTO, context: ContextType)` | Updates a sensor in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext |
| `[SensorDTO]` | `func readSensors(context: ContextType) -> [SensorDTO]` | Retrives an array of sensors sotered in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext |

### Create Sensor

Stores a sensor in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext

```swift
public func createSensor(sensorToStore: SensorDTO, context: ContextType)
```

### Delete Sensor

Deletes a sensor stored in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext

- parameter sensorToStore: `SensorDTO` the object that contains the sensor information to delete
- parameter context: `ContextType` to select in which thread the operation will be performed.

```swift
public func deleteSensor(sensor: SensorDTO, context: ContextType)
```


### Update Sensor

Updates a sensor stored in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext

- parameter sensorToStore: `SensorDTO` the object that contains the sensor information to update
- parameter context: `ContextType` to select in which thread the operation will be performed.

```swift
public func updateSensor(sensor: SensorDTO, context: ContextType)
```

### Read Sensors

Retrives an array of sensors sotered in the local data base, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext

- parameter context: `ContextType` to select in which thread the operation will be performed.
- Returns: An array of `[SensorDTO]` that constains the sensors stored.

```swift
public func readSensors(context: ContextType) -> [SensorDTO]
```

## **TrainingTypeStorage**

TrainingTypeStorage  has an implementation to store, delete, update and read the training types, this class is prepare to perform changes in the main thread and background thread

### CreateTrainingType

Creates a new training type and it is stored in the local data base

- parameter trainingType: The `TrainignType` object  to store.
- parameter context: `ContextType` to select in which thread the operation will be performed.

```swift
public func createTrainingType(trainingType: TrainingType, context: ContextType)
```

### DeleteTrainingType

Deletes a training type stored in the local data base
- parameter trainingType: The `TrainignType` object  to delete.
- parameter context: `ContextType` to select in which thread the operation will be performed.

```swift
public func deleteTrainingType(trainingType: TrainingType, context: ContextType)
```

### UpdateTrainingType

Updates a training type stored in the local data base

- parameter trainingType: The `TrainignType` object  to delete.
- parameter context: `ContextType` to select in which thread the operation will be performed.

```swift
public func updateTrainingType(trainingType: TrainingType, context: ContextType)
```

### ReadTrainingTypes

Reads the training types stored in the local data base
- parameter context: `ContextType` to select in which thread the operation will be performed.
- Returns: An array of `[TrainingType]` that constains the training types stored

```swift
public func readTrainingTypes(context: ContextType) -> [TrainingType]
```

## **RookTrainingStorage**

 Reads an deletes the trainings stored in the local data base, this class is prepare to perform changes in the main thread and background thread

| Returns      | Function | Description |
| ----------- | ----------- | -------- |
| `[RookTrainingDTO]` | `func getUnfinishedTrainings(context: ContextType) -> [RookTrainingDTO]` | Retrives an array of unfinish training sotered in the local data base that does not have a end date assigned, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext |
| `[RookTrainingDTO]` | `func getPendingTrainings(context: ContextType) -> [RookTrainingDTO]` | Retrives an array of pending training sotered in the local data base that does not have a uploadAt date assigned, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext |
| `void` | `deleteTraining(_ training: RookTrainingDTO, context: ContextType)` | Deletes  training sotered in the local data base that does not have a uploadAt date assigned, If the action will be performed in the main thread the context have to be the viewContext, in other case the context should be backGroundContext |

### Get Unfinish Trainings

Retrives an array of unfinish training sotered in the local data base that does not have a end date assigned, If the action will be performed in the main thread the context have to be the viewContext, in other case
the context should be backGroundContext
- parameter context: `ContextType` to select in which thread the operation will be performed.
- Returns: An array of `[RookTrainingDTO]` that constains the unfinish trainings stored

```swift
public func getUnfinishedTrainings(context: ContextType) -> [RookTrainingDTO]
```

### Get Pending 

Retrives an array of pending training sotered in the local data base that does not have a uploadAt date assigned, If the action will be performed in the main thread the context have to be the viewContext, in other
case the context should be backGroundContext
- parameter context: `ContextType` to select in which thread the operation will be performed.
- Returns: An array of `[RookTrainingDTO]` that constains the pending trainings stored

```swift
public func getPendingTrainings(context: ContextType) -> [RookTrainingDTO]
```

## Delete Training

Deletes  training sotered in the local data base that does not have a uploadAt date assigned, If the action will be performed in the main thread the context have to be the viewContext, in other case the context
should be backGroundContext
- parameter context: `ContextType` to select in which thread the operation will be performed.
- parameter context: `RookTrainingDTO` the trainign to delete.

```swift
public func deleteTraining(_ training: RookTrainingDTO, context: ContextType)
```


## **RWModels**

### RWRookUserDTO

```swift
public struct RWRookUserDTO
```
This object contains all the information of the uses

| Type | Name | Description |
| ------ | ------ | -------- |
| `String` | `userUUID` | The uuid to identifiy the user this is provided by the web service. |
| `String?` | `userToken` | This field has to be nil |
| `String` | `name` | The user's name. |
| `String?` | `lastName` | The user's last name. |
| `String?` | `pseudonym` | The user's pseudonym. |
| `String` | `userEmail` | The user's email. |
| `String?` | `userImage` | The url of the user image |
| `RWRookPhysiologicalVariablesDTO?` | `physiologicalVariables` | `RWRookPhysiologicalVariablesDTO` object that contains the physiological variables of the user. |

### RWRookPhysiologicalVariablesDTO

The `RWRookPhysiologicalVariablesDTO` contains the weigth, heith and resting heart rate of the user.

```swift
public struct RWRookPhysiologicalVariablesDTO
```

| Type | Name | Description |
| ------ | ------ | -------- |
| `String` | `weight` | Weight of the user its value has to be from 30 to 200 |
| `String` | `height` | Height of the user its value has to be from 120 to 220 |
| `String` | `restingHeartRate` | Resting heart rate of the user its value from 40 to 100 |

#### RMTrainingType

```swift
public struct RWRookTrainingType
```

The `RWRookTrainingType` this model is used to store the training retrieved from the server.

| Type | Name | Description |
| ------ | ------ | -------- |
| `String?` | `trainingTypeUUID` | The UUID of the training |
| `String?` | `trainigName` | The name of the training |
| `Int?` | `useHeartRate` | An object that indicates if the workout use heart rate |
| `Int?` | `useCycling` | An object that indicates if the workout use cycling |
| `Int?` | `useGps` | An object that indicates if the workout use gps |
| `RWRookUseSteps?` | `useSteps` | An object that indicates if the workout use heart rate |

#### RWRookUseSteps

```swift
public struct RWRookUseSteps
```

The `RWRookUseSteps` model is used to store if a training use steps.

| Type | Name | Description |
| ------ | ------ | -------- |
| `Int` | `enabled` | Int that indicates if steps are enable |
| `String` | `stepsTypes` | String that indicates the type of steps. |

#### RMSensorAPI

```swift
public struct RWRookSensorDTO
```

/// This is model contains the information of a sensor

| Type | Name | Description |
| ------ | ------ | -------- |
| `String` |  `sensorName` | The name of the sensor |
| `String?` | `sensorUUID` | The UUID that identifies the sensor on the server |
| `String?` | `sensorMAC` | The mac of the sensor. |
| `Date?` | `updatedAt` | Sensor update date with format YYYY-MM-dd. |
| `String?` | `ownershipType` | Indicates the ownership type. |

#### RWRookTrainingDTO

The `RWRookTrainingDTO` contains all the information of a training.

```swift
public struct RWRookTrainingDTO
```

| Type | Name | Description |
| ------ | ------ | -------- |
| `String?` | `start` | start date of the workout with the format "yyyy-MM-dd HH:mm:ss" |
| `String?` | `end` | end date of the workout with the format "yyyy-MM-dd HH:mm:ss"  |
| `String?` | `trainingTypeUUID` | The UUID of the training training type that will be performed. |
| `String?` | `sensorUUID` | The UUID of the sensor that is used in the workout. |
| `String?` | `sensorName` | The sensor name that is used in the workout. |
| `String?` | `deviceType` | The device where the workout was performed. |
| `String?` | `uploadedAt` | The uploaded date of the workout. |
| `Int16` | `groupalMode` | Indicates if the training was performed in group. |
| `String?` | `offset` | indicates the offset in hours of the utc start. |
|`RWRookAuxiliarSummaryDTO` | `rookAuxiliarSummary` | Object to store the auxiliary summaries of the workout.  |
|`RWRookTrainingSummaryDTO` |`rookTrainingSummaries` | Object to store the summary of the workout. |
|`RWRookTrainingRecordsDTO?` | `records` | Object to store the list of heart rate records and steps records |
| `RWRookRemoteClassDTO?` | `rookRemoteClass` | Object to store the properties of a remote training |
|`[RWRookTrainingSummaryById]` | `summaries` | Object to store the summary id and its value |

#### RWRookAuxiliarSummaryDTO

```swift
public struct RWRookAuxiliarSummaryDTO
```
RMAuxiliarSummary model helps to store the number of samples ant its value accumulated

| Type | Name | Description |
| ------ | ------ | -------- |
| `Int` | `hrElements` | Number of heart rate samples. |
| `Int` | `hrAccumulated` | Value accumulated of heart rate samples. |
| `Int` | `effortElements` | Number of effort samples. |
| `Int` | `effortAccumulated` | Value accumulated of effort samples. |
| `Int` | `cadenceElements` | Number of cadence samples. |
| `Int` | `cadenceAccumulated` | Value accumulated of cadence samples. |

#### RWTrainingSummaries

```swift
public class RWTrainRWRookTrainingSummaryDTOingSummaries: Object
```
This model contains the training summaries on realtime.

| Type | Name | Description |
| ------ | ------ | -------- |
| `Int` | `durationTimeTot` | Duration of the workout. |
| `Float` | `z1Time` | Time in the first zone. |
| `Float` | `z2Time` | Time in the second zone. |
| `Float` | `z3Time` | Time in the third zone. |
| `Float` | `z4Time` | Time in the fourth zone. |
| `Float` | `z5Time` | Time in the fifth zone. |
| `Int` | `hrMax` | Heart rate max value. |
| `Int` | `hrAvg` | Heart rate min value. |
| `Int` | `hrMin` | Heart rate average value. |
| `Int` | `effortMax` | effort max value. |
| `Int` | `effortAvg` | effort min value. |
| `Int` | `effortMin` | effort average value. |
| `Int` | `calories` | Total calories burned in training. |
| `Float` | `z1Calories` | Total calories burned in the first zone. |
| `Float` | `z2Calories` | Total calories burned in the second zone. |
| `Float` | `z3Calories` | Total calories burned in the third zone. |
| `Float` | `z4Calories` | Total calories burned in the fourth zone. |
| `Float` | `z5Calories` | Total calories burned in the fifth zone. |
| `Int` | `steptsTotal` | Total steps taken in training. |
| `Int` | `z1Steps` | Total steps taken in first zone. |
| `Int` | `z2Steps` | Total steps taken in second zone. |
| `Int` | `z3Steps` | Total steps taken in third zone. |
| `Int` | `z4Steps` | Total steps taken in fourth zone. |
| `Int` | `z5Steps` | Total steps taken in fifth zone. |
| `Int` | `cadenceMax` | Cadence max value. |
| `Int` | `cadenceAvg` | Cadence min value. |
| `Int` | `cadenceMin` | Cadence average value. |
| `Int` | `z1Cadence` | Cadence in the first zone. |
| `Int` | `z2Cadence` | Cadence in the second zone. |
| `Int` | `z3Cadence` | Cadence in the third zone. |
| `Int` | `z4Cadence` | Cadence in the fourth zone. |
| `Int` | `z5Cadence` | Cadence in the fifth zone. |

#### RWRookRemoteClassDTO

```swift
public struct RWRookRemoteClassDTO
```

This model stores the data of a remote class.

| Type | Name | Description |
| ------ | ------ | -------- |
| `String` | `classUUID` | The UUID for the remote class |
| `String` | `roomUUID` | The UUID of the room |
| `String` | `trainingName` | The training name of the class |
| `Int` | `classDelay` | The period that the data will be send |
| `Int` | `useSteps` | Indicator if the training use step |
| `String` | `stepOptions` | Type of steps of the training |

#### RWTrainingStoragedRecords

```swift
public class RWRookTrainingRecordsDTO: Object, Codable
```

This model stores a list of the heart rate data and a list of the steps data.

| Type | Name | Description |
| ------ | ------ | -------- |
| `[HeartRateRecordsDTO]` | `hrDerivedRecords` | List of heart rate data records. |
| `[StepRecordsDTO]` | `stepsDerivedRecords` | List of steps data records. |

#### HeartRateRecordsDTO

```swift
public struct HeartRateRecordsDTO
```

This model contains the steps derived data that can be calculated on the  Equation class.

| Type | Name | Description |
| ------ | ------ | -------- |
| `String` | `timestamp` | Sample date with format "yyyy-MM-dd HH:mm:ss". |
| `Int16` | `heartRate` | Heart rate value. |
| `Float` | `calories` | Calories calculated. |
| `Float` | `effort` | Effort calculated. |
| `String?` | `start` | Start date of the training with format "yyyy-MM-dd HH:mm:ss".  |
| `Float` | `heart_rate_variability` | Heart rate variability. |

#### StepRecordsDTO

```swift
public struct StepRecordsDTO
```

This model contains the steps derived data that can be calculated on the Equation class

| Type | Name | Description |
| ------ | ------ | -------- |
| `String` | `timestamp` | Sample date with format "yyyy-MM-dd HH:mm:ss". |
| `Int64` | `steps` | Number of steps. |
| `Float` | `cadence` | Cadence calculated. |
| `String` | `start` | Start date of the training with format "yyyy-MM-dd HH:mm:ss".  |

#### RWRookTrainingSummaryById

```swift
public struct RWRookTrainingSummaryById
```

This model helps to store the summary id and its value.

| Type | Name | Description |
| ------ | ------ | -------- |
| `Int` | `summaryTypeID` | ID of the summary. |
| `Int` | `value` | value of the summary. |

#### RWHrDerivedRecord

```swift
public class RWHrDerivedRecord: Codable
```

This model contains the heart rate derived information from a sensor sample.

| Type | Name | Description |
| ------ | ------ | -------- |
| `String?` | `timestamp` | Date and time of the sample. |
| `Int?` | `heartRate` | The heart rate sample bpm. |
| `Float?` | `calories` | The calories burned. |
| `Float?` | `effort` | The current effort. |
| `Int?` | `heartRateVariability` | The variability of heart rate sample.   |

#### RWStepDerivedRecord

``` swift
public class RMStepDerivedRecord: Codable
```
This model contains the steps derived data that can be calculated on the Equation class  cadence ,steps  and the  timestamp of this data.

| Type | Name | Description |
| ------ | ------ | -------- |
| `String?` | `timestamp` | Date and time of the sample. |
| `Float?` | `cadence` | The cadence of the sample |
| `Int?` | `steps` | The steps count. |

#### WorkoutConfiguration

Contains all the data to configure a workout session

```swift
public struct  WorkoutConfiguration
```

| Type | Name | Description |
| ----- | --- | ------- |
| `String` | `trainingTypeUUID` | The uuid of the workout type. |
| `Bool` | `useSteps` | Indicates if the step count is enable. |
| `HKWorkoutActivityType` | `getTypeTraining` | the workout activity type linked with the training uuid. |
| `HKWorkoutSessionLocationType` | `locationType` | Indicates if the activity is indoor or outdoor. |

#### RemoteClass

Contains all the data that is used in a remote class, the action are  connect, send information and disconnect .

| Type | Name | Description |
| ----- | --- | ------- |
| `Int` | `id` | The id linked to the remote class |
| `String` | `uuid` | The uuid linked to the remote class |
| `String` | `name` | The name of the remote class |
| `String` | `trainingType` | The activity name of the remote class |
| `String` | `trainingTypeUUID` | The uuid of the activity. |
| `String` | `configurationUUID` | The configuration uuid of the remote class |
| `Int` | `duration` | The number of seconds of the remote class |
| `Int` | `capacity` | The number of places for users. |
| `String` | `classDelay` | The amount of time between each sample is send. |
| `String` | `dataOrder` | Indicates how to order the participants |
| `Int` | `useSteps` | Indicates if the activity use steps |
| `String?` | `typeSteps` | Indicates the type of steps of jumps. |
| `Int` | `waitingTimeRemaining` | The remain time of the waiting room. |

#### RMWResponse

Indicates the response of the request.

```swift
public struct RMResponse
```

| Type | Name | Description |
| ----- | --- | ------- |
| `String` | `code` | The httpCode of the request. |
| `String` | `message` | The message of the response. |
| `Bool` | `success` | Indicates if the request was successful. |

#### RWTRainingUploadResponse

RWTrainingUploadResponse contains the information of the request of a training upload process
 
  Property     |    Description
  ------------ | -----------------
  code         | The http code of the request
  message      | The message of the request
  success      | Indicates if the request was successful
  uuid         | The uuid of the training uploaded
  summaries    | The summaries of the training


## RookMotion

This documentation is provided by **RookMotion** all rights reserved to Rookeries Development SRL de CV.

**contact** : contacto@rookmotion.com  

Startup México SUM Campus Ciudad de México  

+52 55 39406461


